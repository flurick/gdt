[gd_scene load_steps=4 format=2]

[sub_resource type="GDScript" id=1]

script/source = "extends Label

func _ready():
	text = str(global.sh(\"git\", [\"--version\"]).output)
"

[sub_resource type="GDScript" id=3]

script/source = "extends ItemList

signal item_activated_src(text_clicked)

func _ready():
	
	connect(\"item_activated\",self,\"trigger_item_activated_src\")
	
	#list repos in home folders
	for repo in global.sh(\"find\",[\"/home\",\"-name\",\".git\",\"-printf\",\"%p::\"]).output.split(\"::\"):
		add_item( repo.split(\"/\")[ repo.split(\"/\").size()-2 ] )
		set_item_tooltip( get_item_count()-1, repo )


func add_repo(dir):
	add_item(dir.split(\"/\")[-1])
	set_item_tooltip( get_item_count()-1, dir+\".git\" )



func trigger_item_activated_src(index):
	emit_signal( \"item_activated_src\", get_item_tooltip(index) )
	pass"

[sub_resource type="GDScript" id=2]

script/source = "extends ItemList


func open(repo):
	clear()
	for line in global.sh(\"git\", [\"--git-dir\", repo, \"log\", \"--oneline\"]).output.split(\"\\n\"):
		add_item( line )
	get_v_scroll().value = 0


func _on_repo_list_item_activated_src(text_clicked):
	open(text_clicked)
"

[node name="Control" type="Control"]
anchor_left = 0.0
anchor_top = 0.0
anchor_right = 1.0
anchor_bottom = 1.0
rect_pivot_offset = Vector2( 0, 0 )
rect_clip_content = false
mouse_filter = 0
mouse_default_cursor_shape = 0
size_flags_horizontal = 1
size_flags_vertical = 1
_sections_unfolded = [ "Script" ]

[node name="CenterContainer" type="CenterContainer" parent="."]
anchor_left = 0.0
anchor_top = 0.0
anchor_right = 1.0
anchor_bottom = 1.0
margin_left = 18.0
margin_right = 18.0
rect_pivot_offset = Vector2( 0, 0 )
rect_clip_content = false
mouse_filter = 0
mouse_default_cursor_shape = 0
size_flags_horizontal = 1
size_flags_vertical = 1
use_top_left = false

[node name="version" type="Label" parent="."]
anchor_left = 0.0
anchor_top = 0.0
anchor_right = 1.0
anchor_bottom = 0.0
margin_left = 694.0
margin_top = 12.0
margin_right = -10.0
margin_bottom = 43.0
rect_pivot_offset = Vector2( 0, 0 )
rect_clip_content = false
mouse_filter = 2
mouse_default_cursor_shape = 0
size_flags_horizontal = 1
size_flags_vertical = 4
align = 2
percent_visible = 1.0
lines_skipped = 0
max_lines_visible = -1
script = SubResource( 1 )

[node name="repo_browser" type="VBoxContainer" parent="."]
anchor_left = 0.0
anchor_top = 0.0
anchor_right = 0.0
anchor_bottom = 1.0
margin_right = 271.0
rect_pivot_offset = Vector2( 0, 0 )
rect_clip_content = false
mouse_filter = 1
mouse_default_cursor_shape = 0
size_flags_horizontal = 1
size_flags_vertical = 1
alignment = 0

[node name="repo_list" type="ItemList" parent="repo_browser"]
anchor_left = 0.0
anchor_top = 0.0
anchor_right = 0.0
anchor_bottom = 0.0
margin_right = 271.0
margin_bottom = 571.0
rect_pivot_offset = Vector2( 0, 0 )
rect_clip_content = true
focus_mode = 2
mouse_filter = 0
mouse_default_cursor_shape = 0
size_flags_horizontal = 3
size_flags_vertical = 3
items = [  ]
select_mode = 1
allow_reselect = false
max_columns = 3
icon_mode = 1
fixed_icon_size = Vector2( 0, 0 )
script = SubResource( 3 )
_sections_unfolded = [ "Columns", "Icon", "Mouse", "Size Flags" ]

[node name="Panel" type="Panel" parent="repo_browser"]
anchor_left = 0.0
anchor_top = 0.0
anchor_right = 0.0
anchor_bottom = 0.0
margin_top = 575.0
margin_right = 271.0
margin_bottom = 600.0
rect_min_size = Vector2( 25, 25 )
rect_pivot_offset = Vector2( 0, 0 )
rect_clip_content = false
mouse_filter = 0
mouse_default_cursor_shape = 0
size_flags_horizontal = 1
size_flags_vertical = 1
_sections_unfolded = [ "Rect" ]

[node name="Button" type="Button" parent="repo_browser/Panel"]
anchor_left = 0.0
anchor_top = 0.0
anchor_right = 1.0
anchor_bottom = 1.0
rect_pivot_offset = Vector2( 0, 0 )
rect_clip_content = false
focus_mode = 2
mouse_filter = 0
mouse_default_cursor_shape = 0
size_flags_horizontal = 1
size_flags_vertical = 1
toggle_mode = false
enabled_focus_mode = 2
shortcut = null
group = null
text = "Open"
flat = false
align = 1

[node name="git_log" type="ItemList" parent="."]
anchor_left = 0.0
anchor_top = 0.0
anchor_right = 0.0
anchor_bottom = 0.0
margin_left = 336.0
margin_top = 47.0
margin_right = 791.0
margin_bottom = 559.0
rect_pivot_offset = Vector2( 0, 0 )
rect_clip_content = true
focus_mode = 2
mouse_filter = 0
mouse_default_cursor_shape = 0
size_flags_horizontal = 1
size_flags_vertical = 1
items = [  ]
select_mode = 0
allow_reselect = false
icon_mode = 1
fixed_icon_size = Vector2( 0, 0 )
script = SubResource( 2 )

[node name="FileDialog" type="FileDialog" parent="."]
visible = false
anchor_left = 0.0
anchor_top = 0.0
anchor_right = 0.0
anchor_bottom = 0.0
margin_left = 93.0
margin_top = 94.0
margin_right = 422.0
margin_bottom = 499.0
rect_min_size = Vector2( 200, 70 )
rect_pivot_offset = Vector2( 0, 0 )
rect_clip_content = false
mouse_filter = 0
mouse_default_cursor_shape = 0
size_flags_horizontal = 1
size_flags_vertical = 1
popup_exclusive = false
window_title = "Open a Directory"
resizable = false
dialog_hide_on_ok = false
mode_overrides_title = true
mode = 2
access = 0
filters = PoolStringArray(  )
show_hidden_files = false
current_dir = "res://"
current_file = "~"
current_path = "res://~"

[connection signal="item_activated_src" from="repo_browser/repo_list" to="git_log" method="_on_repo_list_item_activated_src"]
[connection signal="pressed" from="repo_browser/Panel/Button" to="FileDialog" method="show"]
[connection signal="confirmed" from="FileDialog" to="." method="_on_FileDialog_confirmed"]
[connection signal="dir_selected" from="FileDialog" to="repo_browser/repo_list" method="add_repo"]
